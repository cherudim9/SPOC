#lab0 SPOC思考题 - 答案

##v9-cpu相关题目

###funcall中的堆栈有多大？是内核态堆栈还是用户态堆栈

128MB-4MB-代码长度-数据区大小。内核态（根据debugger的消息提示可判断）。

###funcall中的全局变量ret放在内存中何处？如何对它寻址？

代码和字符串后面。（0x0000 00a6）

用`xpc-tpc+(ir>>8)`寻址。

###funcall中的字符串放在内存中何处？如何对它寻址？

放在代码后面。（0x0000 0090）

用`xpc-tpc+(ir>>8)`寻址。

###局部变量i在内存中的何处？如何对它寻址？
当进入`write`函数块后，执行了`ENT -8`指令，分配了一个64位的栈空间给`i`（虽然实际上变量`i`只需要32位的空间），之后通过`*(sp+4)`访问`i`。

###当前系统是处于中断使能状态吗？

不在。（根据debugger的消息提示可判断）

###funcall中的函数参数是如何传递的？函数返回值是如何传递的？
在使用JSR调用函数之前，先把所有参数（按从右到左）用`PSHA`之类的压栈指令把参数放到栈中；

函数执行结束后，返回值放在寄存器`a`中。

###分析并说明funcall执行文件的格式和内容

- 00000000~00000003: Magic Number 0xC0DEF00D
- 00000004~00000007: bss，代码区的长度
- 00000008~0000000b: entry，代码的入口位置（即main函数的定义）
- 0000000c~0000000f: flags，值为0
- 00000010~0000009c: 代码内容
- 000000a0~000000b4: 字符串常量
